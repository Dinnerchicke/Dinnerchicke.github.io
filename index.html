<!DOCTYPE html>


<html lang="zh-CN">


<head>
  <meta name="baidu-site-verification" content="code-QdAXqd4Pi2" />
  <meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/Logo.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

  
  

  

</head>

</html>

<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover2.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">CDX</a></h1>
      <div id="subtitle-box">
        
          <span id="subtitle">鲜衣怒马，恰似少年时</span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>




<!-- Subtitle -->

<div id="main">
  <section class="outer">
  
  <article class="articles">
    
    
    
    
    <article
  id="post-comShell"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/10/06/comShell/"
    >comShell
  <i class="article-topping">置顶</i>
</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/10/06/comShell/" class="article-date">
  <time datetime="2020-10-06T08:10:17.000Z" itemprop="datePublished">2020-10-06</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/PStudy/">PStudy</a> / <a class="article-category-link" href="/categories/PStudy/devOps/">devOps</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Shell常用指令"><a href="#Shell常用指令" class="headerlink" title="Shell常用指令"></a>Shell常用指令</h1><p><img src="/2020/10/06/comShell/1.jpg"></p>
<h2 id="文件及命令"><a href="#文件及命令" class="headerlink" title="文件及命令"></a>文件及命令</h2><ul>
<li>cat 显示文件内容</li>
<li>cd ..返回上级目录 cd ../..返回上两级目录</li>
<li>pwd 显示工作路径</li>
<li>more 显示文件内容，空格向后，b向前</li>
<li>head 查看文件开头</li>
<li>tail 查看文件末尾</li>
<li>rm -f 文件名 删除文件</li>
<li>rm -rf 强制删除</li>
<li>cp file1 file2 复制文件</li>
<li>gzip 文件名/目录名 压缩后面文件或文件夹，-d解压</li>
<li>tail -f 文件名 跟踪文件的增长情况，-n显示文件尾部n行内容</li>
<li><em>ranger</em> 好使的浏览文件方法 gg顶部，G底部，g 定位，f查找，还支持鼠标点击！</li>
</ul>
<h2 id="系统常用"><a href="#系统常用" class="headerlink" title="系统常用"></a>系统常用</h2><ul>
<li>ls -s查看目录详细文件信息</li>
<li>sudo apt-get –purge remove <programname> 卸载软件</programname></li>
<li>top 查看当前系统中耗费资源最多进程</li>
<li>data 系统当前时间</li>
<li>ps -ax 查看所有进程</li>
<li>df -h 查看磁盘剩余资源</li>
<li>kill PID 杀死进程，-KILL强制杀死</li>
<li>ss -tlnp 查看哪些进程使用了监听端口</li>
<li>ps aux | grep java | grep -v grep 显示出所有java进程，处理当前grep进程(常用管道命令，grep处理字符串)</li>
<li>shutdown  -h now 关闭系统</li>
<li>strace 跟踪系统调用的执行，-p进程号，-c -p运行一段时间后停止获取数据，-o输出结果，-tt时刻调用，-y路径，-c调用次数等</li>
<li>netstat 统计网络相关协议数据</li>
<li>perf 系统性能分析</li>
<li>free -h 查看内存</li>
<li>dstat 综合分析，-c cpu，-d磁盘，-i 中断统计，-l负载均衡统计，-m内存统计，-n网络统计，-p 进程统计</li>
<li>reboot 重启</li>
<li>logout 注销</li>
</ul>
<h2 id="常用快捷键"><a href="#常用快捷键" class="headerlink" title="常用快捷键"></a>常用快捷键</h2><ul>
<li>Ctrl+c 终止进程</li>
<li>Ctrl+l  清屏</li>
<li>Ctrl+q 退出</li>
<li>/&gt; 将前面一条命令的输出写入到后面的文本中，文本清空后写入</li>
<li>/&gt;&gt; 同&gt;，文本不清空</li>
<li>| 管道命令，以前一个命令的输出作为输入运行，如cat 1.txt | grep ‘hello’ 打印1.txt中带有hello字符串的行</li>
</ul>
<h2 id="VIM"><a href="#VIM" class="headerlink" title="VIM"></a>VIM</h2><h3 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h3><ul>
<li>gg 跳到首行</li>
<li>G 跳到末行</li>
<li>:n 跳到n行</li>
</ul>
<h3 id="替换和取消命令"><a href="#替换和取消命令" class="headerlink" title="替换和取消命令"></a>替换和取消命令</h3><ul>
<li>u undo，取消上一步操作</li>
<li>Ctrl+r 返回到undo之前</li>
</ul>
<h3 id="删除命令"><a href="#删除命令" class="headerlink" title="删除命令"></a>删除命令</h3><ul>
<li>dd 删除光标所在行</li>
<li>dG 删除光标所在行到末尾行的所有内容</li>
<li>D 删除光标所在处到行尾的内容</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li></ul>

    </footer>
  </div>

   
   
</article>

    
    <article
  id="post-深入理解同步与异步"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/06/29/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%90%8C%E6%AD%A5%E4%B8%8E%E5%BC%82%E6%AD%A5/"
    >深入理解同步与异步</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/06/29/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%90%8C%E6%AD%A5%E4%B8%8E%E5%BC%82%E6%AD%A5/" class="article-date">
  <time datetime="2021-06-29T06:33:56.000Z" itemprop="datePublished">2021-06-29</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/PStudy/">PStudy</a> / <a class="article-category-link" href="/categories/PStudy/web-Design/">web-Design</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="深入理解同步与异步"><a href="#深入理解同步与异步" class="headerlink" title="深入理解同步与异步"></a>深入理解同步与异步</h1><h2 id="同步与异步的概念"><a href="#同步与异步的概念" class="headerlink" title="同步与异步的概念"></a>同步与异步的概念</h2><blockquote>
<p>为什么要区分同步与异步？</p>
<p>因为Js是单线程的，如果全都是同步任务的话，主线程就被<code>阻塞</code>了。比如发送一个AJAX请求，如果它是同步的话，那么在等待服务器响应的过程中整个主线程就被阻塞了，其他任务都无法被执行。</p>
<p>就像人在散步的过程中，不可能全程只走路。不观察四周有没有认识的人、突然驶来的车。</p>
</blockquote>
<blockquote>
<p>什么是同步函数？什么是异步函数？</p>
<p>简单来说，同步函数按照顺序执行，且在执行后能<code>立即</code>获得结果。</p>
<p>异步函数调用后马上返回，但是<code>不会马上返回结果</code>，调用者无需阻塞等待，当函数得到结果后会通过<code>回调函数</code>主动通知调用者。</p>
</blockquote>
<h2 id="消息队列与事件循环"><a href="#消息队列与事件循环" class="headerlink" title="消息队列与事件循环"></a>消息队列与事件循环</h2><blockquote>
<p>从图中可知，主线程的所有任务都来自于消息队列(FIFO)。</p>
<p>主线程通过事件循环机制来不断执行从消息队列中取出的任务</p>
</blockquote>
<p><img src="/2021/06/29/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%90%8C%E6%AD%A5%E4%B8%8E%E5%BC%82%E6%AD%A5/1.jpg"></p>
<h2 id="宏任务与微任务"><a href="#宏任务与微任务" class="headerlink" title="宏任务与微任务"></a>宏任务与微任务</h2><h3 id="宏任务"><a href="#宏任务" class="headerlink" title="宏任务"></a>宏任务</h3><blockquote>
<p>什么是宏任务？</p>
<p>宏任务即如下的任务(名称并没有什么实际意义)：</p>
<ul>
<li>渲染事件（如解析 DOM、计算布局、绘制）</li>
<li>用户交互事件（如鼠标点击、滚动页面、放大缩小等）</li>
<li>JavaScript 脚本执行事件</li>
<li>网络请求完成、文件读写完成事件</li>
</ul>
<p>这些任务在消息队列上被取出在主线程上正常执行，我们把这些<code>消息队列中的任务</code>称为宏任务。</p>
</blockquote>
<h3 id="微任务"><a href="#微任务" class="headerlink" title="微任务"></a>微任务</h3><blockquote>
<p>为什么会出现微任务？</p>
<p>因为有的任务<code>实时性</code>要求较高。比如setTimeout里面的任务需要在设定的时间立即执行，但是主线程常常被其他任务占领，这个时候就需要微任务提高任务的优先级，在更精细的时间粒度对任务进行操作。</p>
</blockquote>
<blockquote>
<p>什么是微任务？</p>
<p>微任务就是需要<code>异步执行</code>的函数，执行时机是在<code>主函数执行结束后</code>，当前<code>宏任务结束之前</code></p>
</blockquote>
<blockquote>
<p>微任务有什么？</p>
<ul>
<li>process.nextTick(Node)</li>
<li>Promise.then()/reject()/catch()</li>
<li>Object.Observe</li>
<li>MutationObserver</li>
</ul>
</blockquote>
<blockquote>
<p>微任务是如何被执行的？</p>
<p>通过调用上述API会将微任务添加到微任务队列中。通常当宏任务中的JavaScript快执行结束，即准备退出执行上下文并清空调用栈时(这个时间点被称为检查点)，JavaScript引擎会检查执行上下文的微任务，然后按照顺序执行微任务队列。V8引擎执行微任务队列中的任务直到为空才结束，即执行微任务过程中产生的微任务会立即添加到队尾执行。</p>
</blockquote>
<p><img src="/2021/06/29/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%90%8C%E6%AD%A5%E4%B8%8E%E5%BC%82%E6%AD%A5/2.jpg"></p>
<blockquote>
<p>Tip：微任务与宏任务是绑定的，每个宏任务在执行时会创建自己的微任务队列</p>
</blockquote>
<h3 id="宏任务与微任务执行顺序"><a href="#宏任务与微任务执行顺序" class="headerlink" title="宏任务与微任务执行顺序"></a>宏任务与微任务执行顺序</h3><blockquote>
<p>当宏任务为<code>同步任务</code>时，毫无疑问先执行宏任务</p>
<p>当宏任务与微任务<code>同为异步任务</code>时，注意此时<code>先执行微任务再执行宏任务</code></p>
</blockquote>
<p><img src="/2021/06/29/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%90%8C%E6%AD%A5%E4%B8%8E%E5%BC%82%E6%AD%A5/3.jpg"></p>
<h4 id="特别篇：Async-Await"><a href="#特别篇：Async-Await" class="headerlink" title="特别篇：Async/Await"></a>特别篇：Async/Await</h4><blockquote>
<p>Async做了什么？</p>
<ul>
<li><p>如果你返回的不是promise，会自动用Promise.resolve()包装返回</p>
</li>
<li><p>如果你返回的是promise，则以返回的为准</p>
</li>
</ul>
</blockquote>
<blockquote>
<p>Await做了什么？</p>
<ul>
<li>如果右侧是函数，那么函数的返回值就是结果</li>
<li>如果右侧是非函数，则表达式的结果就是其本身</li>
</ul>
<p>Tip：await还是会执行后面的函数，但是函数后的内容就会被阻塞</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如await会执行async2()，但是后面的内容async1 end就会被阻塞</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">&#x27;async1 start&#x27;</span> )</span><br><span class="line">    <span class="keyword">await</span> async2()</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">&#x27;async1 end&#x27;</span> )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">&#x27;async2&#x27;</span> )</span><br><span class="line">&#125;</span><br><span class="line">async1()</span><br><span class="line"><span class="built_in">console</span>.log( <span class="string">&#x27;script start&#x27;</span> )</span><br></pre></td></tr></table></figure>



<h2 id="宏任务与微任务实战"><a href="#宏任务与微任务实战" class="headerlink" title="宏任务与微任务实战"></a>宏任务与微任务实战</h2><h3 id="第一题"><a href="#第一题" class="headerlink" title="第一题"></a>第一题</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;script start&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise1&#x27;</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise2&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;script end&#x27;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>结果：script start、script end、promise1、promise2、setTimeout</p>
<p>分析：</p>
<ol>
<li>首先执行宏任务的同步任务：script start、script end</li>
<li>接下来执行微任务：当执行微任务时遇到新的微任务一起执行，故promise1、promise2</li>
<li>最后执行异步宏任务的回调函数：setTimeout</li>
</ol>
</blockquote>
<h3 id="第二题"><a href="#第二题" class="headerlink" title="第二题"></a>第二题</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Promise1&#x27;</span>)  </span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout2&#x27;</span>)</span><br><span class="line">  &#125;,<span class="number">0</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout1&#x27;</span>)</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Promise2&#x27;</span>)    </span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>结果：Promise1、setTimeout1、Promise2、setTimeout2</p>
<p>分析：</p>
<ol>
<li>没有同步任务，先执行微任务，即Promise1</li>
<li>执行异步宏任务回调函数setTimeout1</li>
<li>执行微任务：Promise2</li>
<li>执行异步宏任务回调函数setTimeout2</li>
</ol>
</blockquote>
<h3 id="第三题"><a href="#第三题" class="headerlink" title="第三题"></a>第三题</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">    process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;4&#x27;</span>);</span><br><span class="line">        resolve();</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;6&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;7&#x27;</span>);</span><br><span class="line">    resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;8&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;9&#x27;</span>);</span><br><span class="line">    process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;10&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;11&#x27;</span>);</span><br><span class="line">        resolve();</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;12&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>结果：1，7，6，8，2，4，3，5，9，11，10，12</p>
<p>分析；</p>
<ol>
<li>同步输出：1，7</li>
<li>微任务：6，8</li>
<li>异步宏任务setTimeout1：2，4。这里有个坑，setTimeout算一个宏任务，平时同步执行的话整个JavaScript算一个宏任务所以一直执行，这个setTimeout就不能一直执行到下一个。</li>
<li>无同步任务，执行微任务：3，5</li>
<li>异步宏任务setTimeout2：9，10</li>
<li>微任务：10，12</li>
</ol>
</blockquote>
<h3 id="第四题：Async-Await"><a href="#第四题：Async-Await" class="headerlink" title="第四题：Async/Await"></a>第四题：Async/Await</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> async2();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;async1 end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;async2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;script start&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;setTimeout&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">async1();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">    resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;promise2&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;script end&quot;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>结果：script start、async1 start、async2、promise1、script end、promise2、async1 end、setTimeout</p>
<p>分析：</p>
<ol>
<li>同步：script start、async1 start、async2、promise1、script end</li>
<li>微任务：promise2</li>
<li>同步：async1 end、setTimeout</li>
</ol>
<p>Tip：最后一步这样理解：微任务执行完，async2语句结束，后面的代码不再被阻塞，所以直接打印async1 end</p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-design/" rel="tag">web-design</a></li></ul>

    </footer>
  </div>

   
   
</article>

    
    <article
  id="post-迭代器"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/06/28/%E8%BF%AD%E4%BB%A3%E5%99%A8/"
    >迭代器</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/06/28/%E8%BF%AD%E4%BB%A3%E5%99%A8/" class="article-date">
  <time datetime="2021-06-28T14:56:09.000Z" itemprop="datePublished">2021-06-28</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/PStudy/">PStudy</a> / <a class="article-category-link" href="/categories/PStudy/web-Design/">web-Design</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h1><blockquote>
<p>迭代器本质上是一个函数，可以通过这个函数遍历特定数据结构的对象</p>
<p>迭代器模式：提供一种方法顺序访问一个聚合对象中的各种元素，而又不暴露该对象的内部表示。</p>
</blockquote>
<blockquote>
<p>迭代器协议：</p>
<ul>
<li>next()：每次成功调用next都会返回一个IteratorResult对象</li>
</ul>
<p>IteratorResult包括：</p>
<ul>
<li>done：表示是否可以再次调用next(值为true/false)</li>
<li>value：表示当前的值</li>
</ul>
</blockquote>
<blockquote>
<p>提前终止迭代器：</p>
<ul>
<li>利用return提前结束，但是并非所有的迭代器都是可关闭的</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//迭代器就是一个函数，也叫迭代器生成函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Iterator</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> curIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> next = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      value: o[curIndex],</span><br><span class="line">      done: o.length == ++curIndex</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//返回迭代对象，该对象有next方法</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="keyword">let</span> oIt = Iterator(arr)</span><br><span class="line"><span class="built_in">console</span>.log(oIt)</span><br><span class="line"><span class="built_in">console</span>.log(oIt.next()) <span class="comment">// &#123;value:1,done:false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(oIt.next()) <span class="comment">// &#123;value:2,done:false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(oIt.next()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(oIt.next()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.prototype[<span class="built_in">Symbol</span>.iterator]) <span class="comment">// [Function: values]</span></span><br></pre></td></tr></table></figure>



<h2 id="借用原型链实现迭代器"><a href="#借用原型链实现迭代器" class="headerlink" title="借用原型链实现迭代器"></a>借用原型链实现迭代器</h2><blockquote>
<p>实现[Symbol.iterator]即可</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 借用原型链实现迭代器</span></span><br><span class="line"><span class="built_in">Object</span>.prototype[<span class="built_in">Symbol</span>.iterator] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> curIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> next = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      value: <span class="built_in">this</span>[curIndex],</span><br><span class="line">      done: <span class="built_in">this</span>.length == curIndex++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next,</span><br><span class="line">    <span class="keyword">return</span> () &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;执行return提前终止迭代器&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="number">0</span>: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="string">&#x27;b&#x27;</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">  <span class="number">3</span>: <span class="string">&#x27;e&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> obj) &#123;</span><br><span class="line">  <span class="keyword">if</span> (item == <span class="string">&#x27;e&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="原生迭代器"><a href="#原生迭代器" class="headerlink" title="原生迭代器"></a>原生迭代器</h2><h3 id="数组迭代器"><a href="#数组迭代器" class="headerlink" title="数组迭代器"></a>数组迭代器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line"><span class="keyword">let</span> arrEntires = arr.entries() <span class="comment">// entries对应键值对</span></span><br><span class="line"><span class="built_in">console</span>.log(arrEntires.next()) <span class="comment">// &#123;value: [0, 1], done: false&#125;</span></span><br><span class="line"><span class="keyword">let</span> arrKeys = arr.keys() <span class="comment">// 对于数组，索引值就是键值</span></span><br><span class="line"><span class="built_in">console</span>.log(arrKeys.next()) <span class="comment">// &#123;value: 0, done: false&#125;</span></span><br><span class="line"><span class="keyword">let</span> arrValues = arr.values() <span class="comment">// 从第一个值开始</span></span><br><span class="line"><span class="built_in">console</span>.log(arrValues.next()) <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// for...of 遍历默认迭代器接口是values</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item) <span class="comment">// [1,2,3]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里看到两个指向同一个函数</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.prototype[<span class="built_in">Symbol</span>.iterator])</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.prototype.values)</span><br></pre></td></tr></table></figure>



<h3 id="Set迭代器"><a href="#Set迭代器" class="headerlink" title="Set迭代器"></a>Set迭代器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="keyword">let</span> setEntires = set.entries() <span class="comment">// Set，键名与键值相同。</span></span><br><span class="line">setEntires.next() <span class="comment">//&#123;value: [1, 1], done: false&#125;</span></span><br><span class="line"><span class="keyword">let</span> setKeys = set.keys()</span><br><span class="line">setKeys.next() <span class="comment">//&#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="keyword">let</span> setValues = set.values()</span><br><span class="line">setValues.next() <span class="comment">//&#123;value: 1, done: false&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item) <span class="comment">// [1,2,3,4]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里看到两个指向同一个函数</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Set</span>.prototype[<span class="built_in">Symbol</span>.iterator])</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Set</span>.prototype.values)</span><br></pre></td></tr></table></figure>



<h3 id="Map迭代器"><a href="#Map迭代器" class="headerlink" title="Map迭代器"></a>Map迭代器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([ <span class="comment">// 自定义键值对</span></span><br><span class="line">  [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">  [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">])</span><br><span class="line"><span class="keyword">let</span> mapEntires = map.entries()</span><br><span class="line">mapEntires.next() <span class="comment">//&#123;value: [1, 2], done: false&#125;</span></span><br><span class="line"><span class="keyword">let</span> mapKeys = map.keys()</span><br><span class="line">mapKeys.next() <span class="comment">//&#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="keyword">let</span> mapValues = map.values()</span><br><span class="line">mapValues.next() <span class="comment">//&#123;value: 2, done: false&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">  ])) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item) <span class="comment">// [1,2] [3,4]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里看到Map的iterator指向的是entries</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Map</span>.prototype[<span class="built_in">Symbol</span>.iterator])</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Map</span>.prototype.entries)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Map</span>.prototype.values)</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-design/" rel="tag">web-design</a></li></ul>

    </footer>
  </div>

   
   
</article>

    
    <article
  id="post-浏览器错误处理"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/06/22/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/"
    >浏览器错误处理</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/06/22/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" class="article-date">
  <time datetime="2021-06-22T00:34:07.000Z" itemprop="datePublished">2021-06-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/PStudy/">PStudy</a> / <a class="article-category-link" href="/categories/PStudy/web-Design/">web-Design</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="浏览器错误处理"><a href="#浏览器错误处理" class="headerlink" title="浏览器错误处理"></a>浏览器错误处理</h1><h2 id="捕获错误"><a href="#捕获错误" class="headerlink" title="捕获错误"></a>捕获错误</h2><h3 id="try-catch捕获同步错误"><a href="#try-catch捕获同步错误" class="headerlink" title="try/catch捕获同步错误"></a>try/catch捕获同步错误</h3><blockquote>
<p>try/catch是常用的<code>同步</code>捕获错误的方式，语法如下:</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  <span class="comment">// someError</span></span><br><span class="line">&#125;<span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  alert(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="错误类型"><a href="#错误类型" class="headerlink" title="错误类型"></a>错误类型</h4><blockquote>
<p>ES6定义了以下错误类型：</p>
<ul>
<li><strong>EvalError</strong>：eval()参数发生错误时</li>
<li><strong>RangeError</strong>：当数值变量或参数超出其有效范围时发生的错误</li>
<li><strong>ReferenceError</strong>：找不到对象时发生</li>
<li><strong>SyntaxError</strong>：语法错误</li>
<li><strong>TypeError</strong>：当变量或参数不是有效类型</li>
<li><strong>URIError</strong>：在encodeURI()或decodeURI()传递无效参数时发生的错误</li>
</ul>
</blockquote>
<h4 id="推荐使用时机"><a href="#推荐使用时机" class="headerlink" title="推荐使用时机"></a>推荐使用时机</h4><blockquote>
<p>try/catch最好用在自己<code>无法控制</code>的错误上。比如在使用他人维护的库函数时，有时会抛出无法预料的错误，这时就需要try/catch将该函数包裹起来，对可能的错误进行处理。</p>
<p>如果你明确知道自己的函数会发生某种错误，那应该做的是进行条件判断处理而不是try/catch。</p>
</blockquote>
<h3 id="异步捕获错误"><a href="#异步捕获错误" class="headerlink" title="异步捕获错误"></a>异步捕获错误</h3><h4 id="Promise捕获错误"><a href="#Promise捕获错误" class="headerlink" title="Promise捕获错误"></a>Promise捕获错误</h4><blockquote>
<p>在Promise中的异步错误无法被try/catch同步捕获，这时就需要使用异步捕获的方法</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Promise<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">Promise</span>.prototype)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> name = <span class="literal">undefined</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="number">1</span>)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">          resolve()</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">      &#125;)</span><br><span class="line"><span class="javascript">    .then(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="number">2</span>)</span></span><br><span class="line"><span class="javascript">        name = <span class="string">&#x27;aaa&#x27;</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(name)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">          resolve()</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">      &#125;)</span><br><span class="line"><span class="javascript">    &#125;,<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;我是reject&#x27;</span>)</span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="javascript">    .then(<span class="function">()=&gt;</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="number">3</span>)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(name)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">          resolve()</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">delayedResolve</span>(<span class="params">str</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(str)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">          resolve()</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    delayedResolve(<span class="string">&#x27;p1&#x27;</span>)</span></span><br><span class="line"><span class="javascript">      .then(<span class="function">()=&gt;</span>delayedResolve(<span class="string">&#x27;p2&#x27;</span>))</span></span><br><span class="line"><span class="javascript">      .then(<span class="function">()=&gt;</span>delayedResolve(<span class="string">&#x27;p3&#x27;</span>))</span></span><br><span class="line"><span class="javascript">      .then(<span class="function">()=&gt;</span>delayedResolve(<span class="string">&#x27;p4&#x27;</span>))</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&#x27;----------------------&#x27;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;同步错误&#x27;</span>)</span></span><br><span class="line"><span class="javascript">      <span class="built_in">Promise</span>.resolve(<span class="string">&#x27;test&#x27;</span>)</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;我是同步错误执行后的指令&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(error) <span class="comment">// 同步错误捕获成功</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;异步错误&#x27;</span>))</span></span><br><span class="line"><span class="javascript">        <span class="comment">// .catch(reason=&gt;&#123; // 这样才能捕获异步错误, 注释以后浏览器报异步错误</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//   console.log(reason)</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;我是异步错误执行后的指令&#x27;</span>)</span></span><br><span class="line"><span class="javascript">      <span class="built_in">Promise</span>.resolve(<span class="string">&#x27;test&#x27;</span>)</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;我是异步错误执行后的指令&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(error) <span class="comment">// 异步错误捕获失败</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/22/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/1.jpg"></p>
<p><img src="/2021/06/22/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/2.jpg"></p>
<h4 id="async-await捕获错误"><a href="#async-await捕获错误" class="headerlink" title="async/await捕获错误"></a>async/await捕获错误</h4><blockquote>
<p>方法一：使用try/catch捕获错误</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PromiseStateMachine</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (data === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        resolve(<span class="string">&#x27;PromiseStateMachine success&#x27;</span>)</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        reject(<span class="string">&#x27;PromiseStateMachine error&#x27;</span>)</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> PromiseStateMachine(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error, <span class="string">&#x27;捕获成功&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>



<blockquote>
<p>方法二：.catch捕获错误</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> PromiseStateMachine(<span class="number">3</span>).then(<span class="function"><span class="params">r</span>=&gt;</span>r).catch(<span class="function"><span class="params">err</span>=&gt;</span><span class="built_in">console</span>.log(err, <span class="string">&#x27;捕获成功&#x27;</span>))</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>



<blockquote>
<p>方法三：包装await的Promise对象</p>
<p>平时开发中Axios也是使用类似这种方式对每次的请求包装，统一处理</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">awaitWrapper</span>(<span class="params">promise</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> promise.then(<span class="function"><span class="params">res</span>=&gt;</span><span class="built_in">console</span>.log(res))</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(err, <span class="string">&#x27;捕获成功&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> awaitWrapper(PromiseStateMachine(<span class="number">3</span>))</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>



<h2 id="抛出错误"><a href="#抛出错误" class="headerlink" title="抛出错误"></a>抛出错误</h2><blockquote>
<p>与try/catch捕获错误对应的是抛出错误throw</p>
<p><strong>捕获错误的目的是阻止浏览器以默认方式响应，抛出错误的目的是为错误提供有关其发生原因的说明</strong></p>
<p>类似如下：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 常用的自定义错误类型是Error、RangeError、ReferenceError、TypeError</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;some Error&quot;</span>)</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&quot;type Wrong&quot;</span>)</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RangeError</span>(<span class="string">&quot;break size&quot;</span>)</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">ReferenceError</span>(<span class="string">&quot;object Except&quot;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="Error事件"><a href="#Error事件" class="headerlink" title="Error事件"></a>Error事件</h3><blockquote>
<p>任何没有被try/catch的错误都会在window上触发error事件</p>
<p><strong>经过测试，在Chrome上无效！</strong></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onerror = <span class="function">(<span class="params">message, url, line</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(message)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// 可以通过return false来阻止浏览器默认报告错误的行为，但是最好不要</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="错误处理策略"><a href="#错误处理策略" class="headerlink" title="错误处理策略"></a>错误处理策略</h2><blockquote>
<p>前面谈了错误捕获，现在来谈谈如何处理错误</p>
</blockquote>
<h3 id="识别错误"><a href="#识别错误" class="headerlink" title="识别错误"></a>识别错误</h3><blockquote>
<p>通常，大部分错误通过<code>静态代码分析器</code>就能找出，但是部分错误只有在<code>运行时</code>才会发现</p>
</blockquote>
<h4 id="类型转换错误"><a href="#类型转换错误" class="headerlink" title="类型转换错误"></a>类型转换错误</h4><blockquote>
<p>通常在进行类型判断的时候出现，比如以下场景</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span> == <span class="string">&quot;2&quot;</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span> === <span class="string">&quot;2&quot;</span>) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span> == <span class="literal">true</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span> === <span class="literal">true</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>所以推荐使用<code>严格相等(===)</code>和<code>严格不相等(!==)</code>来代替相等和不相等操作符</p>
</blockquote>
<h4 id="数据类型错误"><a href="#数据类型错误" class="headerlink" title="数据类型错误"></a>数据类型错误</h4><blockquote>
<p>对于函数参数，为了确保函数正常运行，常常需要对其进行类型判断</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (url.indexOf(<span class="string">&quot;?&quot;</span>) &gt; <span class="number">-1</span>) <span class="comment">// 错误的方式，一旦传入不是字符串就会出错</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&quot;string&quot;</span>) <span class="comment">// 正确的方式，先进行类型判断再进行indexOf操作</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> arr.sort === <span class="string">&#x27;function&#x27;</span>) <span class="comment">// 错误的方式，在类型检查时只检查特性</span></span><br><span class="line"><span class="keyword">if</span> (arr <span class="keyword">instanceof</span> <span class="built_in">Array</span>) <span class="comment">// 正确的做法，对对象使用instanceof检查</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于类型检查，对<code>基本类型使用typeof</code>，对<code>对象使用instanceof</code></p>
</blockquote>
<h4 id="通信错误"><a href="#通信错误" class="headerlink" title="通信错误"></a>通信错误</h4><blockquote>
<p>JavaScript与服务器通信时出错</p>
<p>通常是URL格式或发送数据格式不对，这时候就需要encodeURIComponent()编码修复</p>
<p>当然Ajax通信自身也会提供关于错误条件的更多信息</p>
</blockquote>
<h3 id="区分重大与非重大错误"><a href="#区分重大与非重大错误" class="headerlink" title="区分重大与非重大错误"></a>区分重大与非重大错误</h3><blockquote>
<p>非重大错误：本质上，不用担心非重大错误</p>
<ul>
<li>不会影响用户的主要任务</li>
<li>只会影响页面中某个部分</li>
<li>可以恢复</li>
<li>重复操作可能成功</li>
</ul>
</blockquote>
<blockquote>
<p>重大错误具备以下特性：</p>
<ul>
<li>应用程序绝对无法继续运行</li>
<li>错误严重影响了用户的主要目标</li>
<li>会导致其他错误发生</li>
</ul>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-design/" rel="tag">web-design</a></li></ul>

    </footer>
  </div>

   
   
</article>

    
    <article
  id="post-客户端存储"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/06/21/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AD%98%E5%82%A8/"
    >客户端存储</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/06/21/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AD%98%E5%82%A8/" class="article-date">
  <time datetime="2021-06-21T02:24:16.000Z" itemprop="datePublished">2021-06-21</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/PStudy/">PStudy</a> / <a class="article-category-link" href="/categories/PStudy/web-Design/">web-Design</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="客户端存储"><a href="#客户端存储" class="headerlink" title="客户端存储"></a>客户端存储</h1><p>注意如果想用HTML运行浏览器环境需要安装Live Server插件并运行该HTML文件</p>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><blockquote>
<p>Cookie是客户端存储的一种方法，但这个方法可以与服务器通信。</p>
<p>Cookie中存储的信息只对<code>被认可的接收者</code>开放，不被其他域访问。</p>
</blockquote>
<blockquote>
<p>Cookie限制：一般来说，遵守以下规则，就不会在任何浏览器中遇到问题；当然如果忽略兼容性，每个浏览器各不相同。</p>
<ol>
<li>不超过300个cookie</li>
<li>每个cookie不超过4096字节，即4K</li>
<li>每个域不超过20个cookie</li>
<li>每个域不超过81920字节</li>
</ol>
</blockquote>
<blockquote>
<p>Cookie组成：除了名称和值，其他都是告诉浏览器什么情况下会在请求中包含cookie，<code>不会发送给服务器</code></p>
<ol>
<li>名称：唯一标识cookie的名称，不区分大小写，会经过URL编码</li>
<li>值：存储在cookie1里的字符串值，会经过URL编码</li>
<li>域：cookie有效的域</li>
<li>路径：请求URL包含这个路径才会把cookie发送给服务器</li>
<li>过期时间</li>
<li>安全标识：设置后只有SSL安全连接时才会把cookie发送给服务器</li>
</ol>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Cookie<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">cookieName,cookieValue,expiresDays</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span></span><br><span class="line">      d.setTime(d.getTime()+(expiresDays*24*60*60*1000));</span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> expires = <span class="string">&quot;expires=&quot;</span>+d.toGMTString();</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.cookie = cookieName+<span class="string">&quot;=&quot;</span>+cookieValue+<span class="string">&quot;; &quot;</span>+expires; <span class="comment">// 键+值+时间</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">cookieName</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> name = cookieName + <span class="string">&quot;=&quot;</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> cookieArr = <span class="built_in">document</span>.cookie.split(<span class="string">&#x27;;&#x27;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt; cookieArr.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> cookieItem = cookieArr[i].trim();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (cookieItem.indexOf(name)==<span class="number">0</span>) &#123; <span class="keyword">return</span> cookieItem.substring(name.length,cookieItem.length); &#125;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">delCookie</span>(<span class="params">cookieName</span>) </span>&#123; <span class="comment">// 通过立即设置过期时间删除Cookie</span></span></span><br><span class="line"><span class="javascript">      setCookie(cookieName, <span class="string">&quot;&quot;</span>, <span class="number">-1</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    setCookie(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;Admin&quot;</span>,<span class="number">30</span>);</span></span><br><span class="line"><span class="javascript">    setCookie(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Nike&quot;</span>,<span class="number">30</span>);</span></span><br><span class="line"><span class="javascript">    setCookie(<span class="string">&quot;lastName&quot;</span>,<span class="string">&quot;Mike&quot;</span>,<span class="number">30</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(getCookie(<span class="string">&quot;name&quot;</span>))</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">document</span>.cookie)</span></span><br><span class="line"><span class="javascript">    delCookie(<span class="string">&quot;username&quot;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">document</span>.cookie)</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在Network网络请求里可以看到Cookie在请求头里被发送到服务端</p>
</blockquote>
<p><img src="/2021/06/21/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AD%98%E5%82%A8/1.jpg"></p>
<blockquote>
<p>在Application里面也可以看到Cookie的内容</p>
</blockquote>
<p><img src="/2021/06/21/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AD%98%E5%82%A8/2.jpg"></p>
<blockquote>
<p>Cookie安全与适用性：</p>
<p>因为CSRF跨站脚本攻击可能会通过插入脚本来窃取网站的Cookie来获取敏感信息，所以有了<code>HTTP-only</code>字段来限制cookie只能在服务器上读取。</p>
<p>并且因为Cookie会与服务器通信，Cookie中保存大量信息可能会影响通信效率，所以Cookie并不是理想的存储大量数据的方式。Cookie应只保留必要信息，但Cookie存在的环境也不是安全的环境，所以也不要将敏感信息放入Cookie。</p>
<p>因为Cookie不适合大容量存储的应用场景，因此其他的客户端存储技术出现了。</p>
</blockquote>
<h2 id="Web-Storage"><a href="#Web-Storage" class="headerlink" title="Web Storage"></a>Web Storage</h2><blockquote>
<p>Web Storage定义了两个对象<code>localStorage(永久存储机制)</code>和<code>sessionStorage(跨会话存储机制)</code>，这两种浏览器存储API提供了在浏览器中不受页面刷新影响而影响存储数据的两种方式</p>
</blockquote>
<blockquote>
<p>Storage类型的方法：可以认为是两个对象的基类，二者都继承它的方法</p>
<ul>
<li>clear():删除所有值，不在FireFox中实现</li>
<li>getItem(name):取得给定name的值</li>
<li>key(index):取得给定数值位置的名称</li>
<li>removeItem(name):删除给定name的键值对</li>
<li>setItem(name,value):设置给定name的值</li>
</ul>
</blockquote>
<h3 id="SessionStorage对象-跨会话存储"><a href="#SessionStorage对象-跨会话存储" class="headerlink" title="SessionStorage对象(跨会话存储)"></a>SessionStorage对象(跨会话存储)</h3><blockquote>
<p>sessionStorage对象只存储会话数据，数据只存储到浏览器关闭，<code>不受到刷新影响</code></p>
<p>大小限制：5M</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>SessionStorage<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    sessionStorage.setItem(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;sessionItem&quot;</span>) <span class="comment">// setItem()赋值</span></span></span><br><span class="line"><span class="javascript">    sessionStorage.clear() <span class="comment">// clear()删除</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    sessionStorage.setItem(<span class="string">&quot;策略&quot;</span>, <span class="string">&quot;跨会话存储&quot;</span>)</span></span><br><span class="line"><span class="javascript">    sessionStorage.setItem(<span class="string">&quot;消失时间&quot;</span>, <span class="string">&quot;浏览器关闭&quot;</span>)</span></span><br><span class="line"><span class="javascript">    sessionStorage.setItem(<span class="string">&quot;大小&quot;</span>, <span class="string">&quot;5M&quot;</span>)</span></span><br><span class="line"><span class="javascript">    sessionStorage.test = <span class="string">&quot;推荐使用API而不是直接赋值&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(sessionStorage.getItem(<span class="string">&quot;test&quot;</span>)) <span class="comment">// getItem()获得Item值</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(sessionStorage.key(<span class="number">2</span>)) <span class="comment">// 根据索引获得该位置的键名，注意不是键值</span></span></span><br><span class="line"><span class="javascript">    sessionStorage.removeItem(<span class="string">&quot;test&quot;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(sessionStorage)</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/21/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AD%98%E5%82%A8/3.jpg"></p>
<h3 id="localStorage-持久化存储"><a href="#localStorage-持久化存储" class="headerlink" title="localStorage(持久化存储)"></a>localStorage(持久化存储)</h3><blockquote>
<p>localStorage会保留到通过JavaScript删除或者用户清除浏览器缓存，<code>不受刷新、关闭窗口、或者重启浏览器影响</code></p>
<p>大小限制：5M</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>localStorage<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;localItem&quot;</span>) <span class="comment">// setItem()赋值</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">localStorage</span>.clear() <span class="comment">// clear()删除</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;策略&quot;</span>, <span class="string">&quot;跨会话存储&quot;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;消失时间&quot;</span>, <span class="string">&quot;浏览器关闭&quot;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;大小&quot;</span>, <span class="string">&quot;5M&quot;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">localStorage</span>.test = <span class="string">&quot;推荐使用API而不是直接赋值&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;test&quot;</span>)) <span class="comment">// getItem()获得Item值</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">localStorage</span>.key(<span class="number">2</span>)) <span class="comment">// 根据索引获得该位置的键名，注意不是键值</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">localStorage</span>.removeItem(<span class="string">&quot;test&quot;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">localStorage</span>)</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/21/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AD%98%E5%82%A8/4.jpg"></p>
<h3 id="存储事件"><a href="#存储事件" class="headerlink" title="存储事件"></a>存储事件</h3><blockquote>
<p>Storage对象发生变化时会触发对应事件，使用属性或setItem()/removeItem()/clear()都会触发这个事件，有以下属性</p>
<ul>
<li>domain(存储变化对应的域)</li>
<li>key(对应的键值)</li>
<li>newValue(新值)</li>
<li>oldValue(旧值)</li>
</ul>
</blockquote>
<blockquote>
<p>在Chrome中，StorageEvent需要另一个页面才能触发</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>storageEvent-Create<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 第一个页面创建事件</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">&quot;storage&quot;</span>,<span class="function"><span class="params">event</span>=&gt;</span><span class="built_in">console</span>.log(event)) <span class="comment">// 添加事件</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;策略&quot;</span>, <span class="string">&quot;跨会话存储&quot;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;消失时间&quot;</span>, <span class="string">&quot;浏览器关闭&quot;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;大小&quot;</span>, <span class="string">&quot;5M&quot;</span>)</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>storageEvent-Get<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;del&quot;</span>&gt;</span></span><br><span class="line">    删除localStorageItem</span><br><span class="line">  <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 第二个页面触发事件，注意触发后要回到第一个页面查看</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">localStorage</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">&#x27;del&#x27;</span>).onclick = <span class="function">() =&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">localStorage</span>.removeItem(<span class="built_in">localStorage</span>.key(<span class="number">1</span>))</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/21/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AD%98%E5%82%A8/5.jpg"></p>
<h2 id="IndexDB"><a href="#IndexDB" class="headerlink" title="IndexDB"></a>IndexDB</h2><blockquote>
<p>类似MySQL的NoSQL数据库，但会出现兼容性问题，不推荐使用，故不赘述</p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-design/" rel="tag">web-design</a></li></ul>

    </footer>
  </div>

   
   
</article>

    
    <article
  id="post-Animation动画"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/06/08/Animation%E5%8A%A8%E7%94%BB/"
    >Animation动画</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/06/08/Animation%E5%8A%A8%E7%94%BB/" class="article-date">
  <time datetime="2021-06-08T08:07:22.000Z" itemprop="datePublished">2021-06-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/PStudy/">PStudy</a> / <a class="article-category-link" href="/categories/PStudy/web-Design/">web-Design</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Animation动画"><a href="#Animation动画" class="headerlink" title="Animation动画"></a>Animation动画</h1> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-design/" rel="tag">web-design</a></li></ul>

    </footer>
  </div>

   
   
</article>

    
    <article
  id="post-浏览器页面相关"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/06/04/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2%E7%9B%B8%E5%85%B3/"
    >浏览器页面相关</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/06/04/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2%E7%9B%B8%E5%85%B3/" class="article-date">
  <time datetime="2021-06-04T08:02:57.000Z" itemprop="datePublished">2021-06-04</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/PStudy/">PStudy</a> / <a class="article-category-link" href="/categories/PStudy/web-Design/">web-Design</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="浏览器页面相关"><a href="#浏览器页面相关" class="headerlink" title="浏览器页面相关"></a>浏览器页面相关</h1><h2 id="DOM树的形成流程"><a href="#DOM树的形成流程" class="headerlink" title="DOM树的形成流程"></a>DOM树的形成流程</h2><blockquote>
<ol>
<li>网络进程接收到响应头后，根据Content-Type字段判断文件类型</li>
<li>如果是”text/html”，浏览器会判断这是一个HTML类型的文件，然后为该请求选择或者创建一个渲染进程</li>
<li>渲染进程准备好后，网络进程和渲染进程之间会建立一个共享数据的管道</li>
<li>网络进程接收的字节流会传向渲染进程的HTML解析器</li>
<li>HTML解析器会动态接收字节流并将其解析为DOM</li>
</ol>
</blockquote>
<p><img src="/2021/06/04/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2%E7%9B%B8%E5%85%B3/1.png"></p>
<h3 id="字节流转换为DOM的流程"><a href="#字节流转换为DOM的流程" class="headerlink" title="字节流转换为DOM的流程"></a>字节流转换为DOM的流程</h3><blockquote>
<p>第一阶段：通过<code>分词器</code>将字节流转换为Token，上述的HTML代码转换为Token如下</p>
</blockquote>
<p><img src="/2021/06/04/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2%E7%9B%B8%E5%85%B3/2.png"></p>
<h3 id="Token解析为DOM-DOM添加到DOM树"><a href="#Token解析为DOM-DOM添加到DOM树" class="headerlink" title="Token解析为DOM/DOM添加到DOM树"></a>Token解析为DOM/DOM添加到DOM树</h3><blockquote>
<p>第二/三阶段：这两个阶段是同步进行的，将Token解析为DOM节点的同时将其添加到DOM树中</p>
<p>HTML解析器维护了一个Token栈结构，具体实现如Mustache模板引擎<a target="_blank" rel="noopener" href="https://git.io/JYv3A">https://git.io/JYv3A</a></p>
<p>算法实现即使用栈结构对tag进行判断，将其闭合输出为DOM</p>
</blockquote>
<p><img src="/2021/06/04/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2%E7%9B%B8%E5%85%B3/3.png"></p>
<h2 id="JavaScript是如何影响DOM树构建的"><a href="#JavaScript是如何影响DOM树构建的" class="headerlink" title="JavaScript是如何影响DOM树构建的"></a>JavaScript是如何影响DOM树构建的</h2><blockquote>
<p>引入JavaScript会阻塞DOM：假如在DOM中插入一段JavaScript脚本，解析到JavaScript时，渲染引擎检测到这是一段脚本，此时HTML会<code>暂停DOM的解析</code>，因为接下来可能要修改已生成的DOM。执行这段脚本以后，继续解析后序的内容，直至生成最终的DOM。</p>
<p>因为Js可能操作样式，所以如果代码里<code>引用了外部的CSS文件</code>，那么在执行Js之前，还需要<code>等待外部CSS文件下载完成</code>，并解析生成CSSOM对象后，才执行Js脚本。</p>
<p>所以Js会阻塞DOM加载，CSS会阻塞Js加载。</p>
</blockquote>
<blockquote>
<p>Chrome浏览器对Js阻塞DOM的优化：</p>
<ol>
<li><code>预解析</code>：当渲染引擎收到字节流后，会开启一个预解析线程，用来分析HTML中包含的Js、CSS等文件，解析到相关文件后，预解析线程会提前下载这些文件</li>
<li><code>CDN</code>：加速Js文件加载、压缩Js文件的体积</li>
<li>如果Js文件中没有操作DOM相关的代码，就可以将该Js脚本设置为异步加载，如<code>async</code>或<code>defer</code></li>
</ol>
</blockquote>
<blockquote>
<p>当HTML文件中包含了CSS外部引用和Js外部文件时，它们的渲染流水线如下：</p>
<ul>
<li>在接收到HTML数据后的解析过程中，HTML预解析器识别出有CSS、Js文件需要下载，同时发起请求，且这个过程是并行的</li>
</ul>
</blockquote>
<p><img src="/2021/06/04/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2%E7%9B%B8%E5%85%B3/4.png"></p>
<h2 id="影响页面展示的因素及优化策略"><a href="#影响页面展示的因素及优化策略" class="headerlink" title="影响页面展示的因素及优化策略"></a>影响页面展示的因素及优化策略</h2><blockquote>
<p>从发起URL请求到首次显示页面的内容，在视觉上经历的三个阶段：</p>
<ol>
<li>等请求发出去，到提交数据阶段，这时页面显示出来的还是<code>之前页面的内容</code></li>
<li>提交数据之后渲染进程会创建一个空白页面，我们通常把这段时间称之为<code>解析白屏</code>，并等待CSS文件和JavaScript文件加载完成，并生成CSSOM和DOM，合成布局树，最后经过一系列步骤准备首屏渲染。</li>
<li>等首次渲染完成后，就开始进入完整页面的生成阶段了，紧接着页面会被一点点渲染出来</li>
</ol>
</blockquote>
<blockquote>
<p>缩短白屏解析时间策略：</p>
<ul>
<li>通过内联JavaScript、内联CSS来移除这两种类型的文件下载</li>
<li>并不是所有场合都适合内联，还可以尽量减少文件大小，比如通过webpack的shaking tree、dropConsole等方法压缩JavaScript</li>
<li>还可以将一些不需要在解析HTML阶段使用的JavaScript标记上async或者defer</li>
<li>对于大CSS文件，可以通过媒体查询属性将其拆分为多个不同用途的CSS文件，在特定场景下才会加载的特定CSS文件</li>
</ul>
</blockquote>
<p><img src="/2021/06/04/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2%E7%9B%B8%E5%85%B3/5.png"></p>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><h3 id="为什么CSS动画比JavaScript高效"><a href="#为什么CSS动画比JavaScript高效" class="headerlink" title="为什么CSS动画比JavaScript高效"></a>为什么CSS动画比JavaScript高效</h3><blockquote>
<p>因为CSS动画中的合成阶段是使用分层线程完成的，并不会占据主线程，所以比JavaScript高效</p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-design/" rel="tag">web-design</a></li></ul>

    </footer>
  </div>

   
   
</article>

    
    <article
  id="post-Axios源码分析"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/06/03/Axios%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"
    >Axios源码分析</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/06/03/Axios%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" class="article-date">
  <time datetime="2021-06-03T06:36:04.000Z" itemprop="datePublished">2021-06-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/PStudy/">PStudy</a> / <a class="article-category-link" href="/categories/PStudy/web-Design/">web-Design</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Axios源码分析"><a href="#Axios源码分析" class="headerlink" title="Axios源码分析"></a>Axios源码分析</h1> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-design/" rel="tag">web-design</a></li></ul>

    </footer>
  </div>

   
   
</article>

    
    <article
  id="post-浏览器中的页面循环系统"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/"
    >浏览器中的页面循环系统</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/" class="article-date">
  <time datetime="2021-06-03T01:45:34.000Z" itemprop="datePublished">2021-06-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/PStudy/">PStudy</a> / <a class="article-category-link" href="/categories/PStudy/web-Design/">web-Design</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="浏览器中的页面循环系统"><a href="#浏览器中的页面循环系统" class="headerlink" title="浏览器中的页面循环系统"></a>浏览器中的页面循环系统</h1><h2 id="消息队列和事件循环"><a href="#消息队列和事件循环" class="headerlink" title="消息队列和事件循环"></a>消息队列和事件循环</h2><blockquote>
<p>因为每个渲染进程都有一个主进程，并且主进程非常忙碌，所以需要一个系统来对各种任务进行统筹调度，即<code>消息队列</code>和<code>事件循环</code>系统</p>
</blockquote>
<h3 id="单线程处理"><a href="#单线程处理" class="headerlink" title="单线程处理"></a>单线程处理</h3><blockquote>
<p>如果使用单线程顺序执行任务的话，显而易见并不能持续的执行任务，当任务执行完后就会退出线程</p>
</blockquote>
<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/2.png"></p>
<h3 id="循环处理任务"><a href="#循环处理任务" class="headerlink" title="循环处理任务"></a>循环处理任务</h3><blockquote>
<p>引入循环机制：</p>
<ol>
<li>线程会一直循环</li>
<li>可以通过事件来等待用户输入，输入完成后激活线程</li>
</ol>
</blockquote>
<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/3.png"></p>
<h3 id="引入多线程模型"><a href="#引入多线程模型" class="headerlink" title="引入多线程模型"></a>引入多线程模型</h3><blockquote>
<p>当出现多线程时，情况就不一样了</p>
</blockquote>
<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/4.png"></p>
<blockquote>
<p>线程需要接收其他线程传来的数据，一个通用的模式就是使用<code>消息队列</code>，先进先出的队列</p>
</blockquote>
<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/5.png"></p>
<blockquote>
<p>从图中可知：</p>
<ul>
<li>渲染主线程会循环从消息队列的队首中取出任务执行</li>
<li>其他线程会向消息队列的队尾推送任务以供主线程执行</li>
</ul>
</blockquote>
<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/6.png"></p>
<h3 id="引入跨进程通信-IPC-模型"><a href="#引入跨进程通信-IPC-模型" class="headerlink" title="引入跨进程通信(IPC)模型"></a>引入跨进程通信(IPC)模型</h3><blockquote>
<p>从图中可以看出，IO线程会处理其他进程传来的IPC内容，然后提交到消息队列执行</p>
</blockquote>
<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/1.png"></p>
<h2 id="宏任务与微任务"><a href="#宏任务与微任务" class="headerlink" title="宏任务与微任务"></a>宏任务与微任务</h2><blockquote>
<p>随着浏览器的发展，消息队列这种粗时间粒度的任务已经不能胜任部分需求，所以出现了<code>微任务</code>，在实时性和效率之间做一个权衡</p>
</blockquote>
<h3 id="宏任务"><a href="#宏任务" class="headerlink" title="宏任务"></a>宏任务</h3><blockquote>
<p>宏任务(macrotask)：</p>
<ul>
<li>script</li>
<li>setTimeout/setInterval</li>
<li>UI渲染</li>
<li>I/O</li>
</ul>
</blockquote>
<blockquote>
<p>为了协调这些任务能有条不紊的在主线程上运行，渲染进程内部会维护多个消息队列，比如<code>延迟执行队列</code>和普通的<code>消息队列</code>，然后主线程不断从这些任务队列中取出任务执行任务，我们将这些消息队列中的任务称为<code>宏任务</code></p>
<p>但是宏任务例如settimeout，想延迟xms后执行，但是往往可能会被插入很多系统级的任务，导致不会在我们预期的时间执行回调函数。</p>
<p>故宏任务的时间粒度不能满足一些高实时性的需求，所以就有了微任务。</p>
</blockquote>
<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/7.png"></p>
<h3 id="微任务"><a href="#微任务" class="headerlink" title="微任务"></a>微任务</h3><blockquote>
<p>微任务(microtask)：</p>
<ol>
<li>Promise.then/catch/finally</li>
<li>Object.observe</li>
<li>MutaionObserver</li>
<li>process.nextTick(Node.js)</li>
</ol>
<p>产生微任务的方式：</p>
<ol>
<li>使用MustationObserver监控某个DOM节点，然后通过JavaScript来修改这个节点，或者为这个节点添加、删除部分子节点，当DOM节点发生变化时，就会产生DOM变化记录的微任务</li>
<li>使用Promise，当调用Promise.resolve()/reject()时，也会产生微任务</li>
</ol>
</blockquote>
<blockquote>
<p>微任务就是一个需要<code>异步执行</code>的函数，执行时机在<code>主函数执行结束之后</code>，当前<code>宏任务结束之前</code></p>
<p>创建时机：在JavaScript执行一段脚本时，V8会为其创建一个全局执行上下文，与此同时也会创建一个<code>微任务队列</code>。</p>
<p>何时被执行：通常在宏任务中的JavaScript快执行完成时，即<code>JavaScript引擎准备退出全局执行上下文并清空调用栈时</code>，JavaScript引擎会检查全局执行上下文的微任务队列，并按照顺序执行其中的任务，除了在退出全局执行上下文这个检查点外还有其他检查点，不过不太重要。</p>
<p>如果在执行微任务的过程中产生了新的微任务，同样会把该微任务添加到微任务队列中并执行，直到队列为空才结束。</p>
</blockquote>
<blockquote>
<p>该示意图是在执行一个 ParseHTML 的宏任务，在执行过程中，遇到了 JavaScript 脚本，那么就暂停解析流程，进入到 JavaScript 的执行环境。从图中可以看到，全局上下文中包含了微任务列表。</p>
</blockquote>
<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/8.png"></p>
<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/9.png"></p>
<blockquote>
<p>结论：</p>
<ul>
<li>微任务和宏任务是<code>绑定的</code>，每个宏任务在执行时，会创建自己的微任务队列</li>
<li>微任务的执行时长会影响到当前宏任务的时长</li>
</ul>
</blockquote>
<h2 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async/Await"></a>Async/Await</h2><h3 id="生成器-Generator-amp-协程-Coroutine"><a href="#生成器-Generator-amp-协程-Coroutine" class="headerlink" title="生成器(Generator)&amp;协程(Coroutine)"></a>生成器(Generator)&amp;协程(Coroutine)</h3><blockquote>
<p>生成器函数的特性：</p>
<ul>
<li>在生成器函数内部执行一段代码，如果遇到 yield 关键字，那么 JavaScript 引擎将返回关键字后面的内容给外部，并暂停该函数的执行。</li>
<li>外部函数可以通过 next 方法恢复函数的执行</li>
</ul>
</blockquote>
<blockquote>
<p>协程：协程是比线程更轻量级的存在，可以看成跑在线程上的任务，一个线程上可以<code>存在多个协程</code>，但是在线程上只能<code>执行一个线程</code>。</p>
<p>一个线程可以拥有多个协程，协程不是被操作系统内核管理的，而完全是由程序所控制(也就是在用户态执行)，性能大大提升，不会像线程切换那样消耗性能。</p>
</blockquote>
<blockquote>
<p>执行这一段代码，会发现genDemo()函数是与全局代码交替执行的，这就是生成器函数Generator的特性，可以暂停执行，也可以恢复执行</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">genDemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot; 开始执行第一段 &quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;generator 2&#x27;</span></span><br><span class="line"> </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot; 开始执行第二段 &quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;generator 2&#x27;</span></span><br><span class="line"> </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot; 开始执行第三段 &quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;generator 2&#x27;</span></span><br><span class="line"> </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot; 执行结束 &quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;generator 2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;main 0&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> gen = genDemo()</span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;main 1&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;main 2&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;main 3&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;main 4&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/10.png"></p>
<blockquote>
<p>父协程和gen协程切换调用栈</p>
</blockquote>
<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/11.png"></p>
<blockquote>
<p>在JavaScript中，生成器就是协程的一种实现方式</p>
</blockquote>
<blockquote>
<p>通过生成器·配合执行器，就能使用同步的方式写出异步代码了</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//foo 函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> response1 = <span class="keyword">yield</span> fetch(<span class="string">&#x27;https://www.geekbang.org&#x27;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;response1&#x27;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(response1)</span><br><span class="line">    <span class="keyword">let</span> response2 = <span class="keyword">yield</span> fetch(<span class="string">&#x27;https://www.geekbang.org/test&#x27;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;response2&#x27;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(response2)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 执行 foo 函数的代码</span></span><br><span class="line"><span class="keyword">let</span> gen = foo()</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getGenPromise</span>(<span class="params">gen</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gen.next().value</span><br><span class="line">&#125;</span><br><span class="line">getGenPromise(gen).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;response1&#x27;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(response)</span><br><span class="line">    <span class="keyword">return</span> getGenPromise(gen)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;response2&#x27;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(response)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="Async-Await与协程"><a href="#Async-Await与协程" class="headerlink" title="Async/Await与协程"></a>Async/Await与协程</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">let</span> a = <span class="keyword">await</span> <span class="number">100</span></span><br><span class="line">    <span class="built_in">console</span>.log(a)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">0</span>)</span><br><span class="line">foo()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/12.png"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-design/" rel="tag">web-design</a></li></ul>

    </footer>
  </div>

   
   
</article>

    
    <article
  id="post-V8工作原理"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/"
    >V8工作原理</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/" class="article-date">
  <time datetime="2021-06-02T02:17:10.000Z" itemprop="datePublished">2021-06-02</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/PStudy/">PStudy</a> / <a class="article-category-link" href="/categories/PStudy/web-Design/">web-Design</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="V8工作原理"><a href="#V8工作原理" class="headerlink" title="V8工作原理"></a>V8工作原理</h1><h2 id="栈与堆：数据如何存储"><a href="#栈与堆：数据如何存储" class="headerlink" title="栈与堆：数据如何存储"></a>栈与堆：数据如何存储</h2><p><img src="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/1.png"></p>
<blockquote>
<p>在JavaScript执行过程中，主要有三种类型内存空间：</p>
<ul>
<li>代码空间：存储可执行代码</li>
<li>栈空间：存储执行上下文，原始类型被存储在里面</li>
<li>堆空间：存储引用类型，将引用类型地址保留在栈空间中</li>
</ul>
</blockquote>
<blockquote>
<p>为什么要分栈和堆？</p>
<ul>
<li>因为Js引擎需要栈保证上下文切换的效率，所以栈空间一般都不会设置太大</li>
<li>而堆空间很大可以存放很多大数据，不过缺点是分配内存和回收内存都会占用一定的时间</li>
</ul>
</blockquote>
<blockquote>
<p>闭包内存创建流程：</p>
<ol>
<li>当Js引擎发现内部函数引用了外部函数的变量时，即是闭包。</li>
<li>于是在堆空间创建一个closure(函数名)的对象</li>
<li>继续扫描，将引用的变量放入closure中</li>
</ol>
</blockquote>
<h2 id="垃圾回收机制"><a href="#垃圾回收机制" class="headerlink" title="垃圾回收机制"></a>垃圾回收机制</h2><h3 id="调用栈的数据是如何回收的"><a href="#调用栈的数据是如何回收的" class="headerlink" title="调用栈的数据是如何回收的"></a>调用栈的数据是如何回收的</h3><blockquote>
<p>通过记录当前执行状态的指针ESP来实现</p>
<p>当showName函数执行结束后，ESP向下移动，上面的showName的执行上下文虽然依然存在，但是已经是无效的了，下次有新的上下文会覆盖掉这块内容</p>
</blockquote>
<p><img src="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/2.png"></p>
<h3 id="堆中的数据是如何回收的"><a href="#堆中的数据是如何回收的" class="headerlink" title="堆中的数据是如何回收的"></a>堆中的数据是如何回收的</h3><blockquote>
<p>从上面<code>栈中的数据是如何回收的</code>可以知道调用栈是通过移动指针ESP来实现的</p>
<p>但是<code>堆</code>中的对象依然占用着空间，要回收堆中的垃圾数据，就要用到垃圾回收机制了</p>
</blockquote>
<blockquote>
<p>V8会把堆分为<code>新生代</code>和<code>老生代</code>两个区域，新生代中存放的是<code>生存时间短的对象</code>，老生代中存放的是<code>生存时间久的对象</code></p>
<ul>
<li>新生区通常只支持1-8M的容量，而老生区支持的容量就大很多</li>
<li>新生区使用<code>副垃圾回收器</code>，老生区使用<code>主垃圾回收器</code></li>
</ul>
</blockquote>
<h4 id="代际假说"><a href="#代际假说" class="headerlink" title="代际假说"></a>代际假说</h4><blockquote>
<p>后续垃圾回收策略都是建立在该假说的基础上的</p>
</blockquote>
<blockquote>
<p>代际假说特点：适用于大多数动态语言</p>
<ol>
<li>大部分对象在内存中存在的时间很短</li>
<li>不死的对象，会活的更久</li>
</ol>
</blockquote>
<h4 id="垃圾回收器的工作流程"><a href="#垃圾回收器的工作流程" class="headerlink" title="垃圾回收器的工作流程"></a>垃圾回收器的工作流程</h4><blockquote>
<p>不论什么类型的垃圾回收器，都有一套共同的执行流程</p>
<ol>
<li>标记空间中活动对象和非活动对象，所谓活动就是还在使用的对象，非活动对象就是可以进行垃圾回收的对象</li>
<li>回收非活动对象所占据的内存</li>
<li>内存管理：因为一般来说，频繁回收对象以后，内存就会存在大量不连续空间，当内存中出现大量的内存碎片以后，如果需要分配较大连续内存的时候就会出现内存不足的情况(这一步其实是可选的，因为有的垃圾回收器不会产生内存碎片，比如副垃圾回收器)</li>
</ol>
</blockquote>
<h4 id="副垃圾回收器"><a href="#副垃圾回收器" class="headerlink" title="副垃圾回收器"></a>副垃圾回收器</h4><blockquote>
<p>新生代中用Scavenge算法来处理，即把新生代空间对半划分为<code>对象区域</code>和<code>空闲区域</code></p>
</blockquote>
<p><img src="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/3.png"></p>
<blockquote>
<p>操作时机：新加入的对象<code>都会存放到对象区域</code>，当对象区域快被写满时，就要执行一次GC</p>
<p>新生区较小：因为新生区经常要进行操作，如果新生区设置太大则需要大量时间，所以新生区一般会设置的比较小</p>
<p>对象晋升策略：经过两次垃圾回收依然存活的对象，会被移动到老生区中</p>
</blockquote>
<blockquote>
<p>垃圾回收过程：</p>
<ol>
<li>首先对对象区域的垃圾做标记</li>
<li>标记完成后，就进入垃圾清理阶段，副垃圾回收器会把这些存活的对象复制到空闲区域中，同时它还会把这些对象有序排列起来，所以这个过程也就相当于完成了内存整理操作</li>
<li>完成复制后，对象区域与 空闲区域交换，这样就完成了垃圾对象的回收操作。</li>
</ol>
</blockquote>
<h4 id="主垃圾回收器"><a href="#主垃圾回收器" class="headerlink" title="主垃圾回收器"></a>主垃圾回收器</h4><blockquote>
<p>标记清除(Mark-Sweep)算法：因为老生区的对象较大，故在老生区使用Scavenge算法进行垃圾回收将会花费大量时间，故使用标记-清除(Mark-Sweep)算法进行回收</p>
<p>除了新生区的晋升对象，一些大的对象会直接被分配到老生区，因此老生区中的对象有两个特点：</p>
<ol>
<li>对象占用空间大</li>
<li>对象存活时间长</li>
</ol>
</blockquote>
<blockquote>
<p>标记清除算法流程：</p>
<ol>
<li>首先是标记过程，标记元素就是通过一组根元素开始，递归遍历这组元素，在这个遍历过程中能到达的元素就称为活动对象，否则为垃圾数据</li>
<li>接下来对垃圾数据进行清除</li>
<li>以上就是标记-清除算法，紧接着是标记-整理(Mark-Compact)算法，因为对一块内存进行多次执行标记后会产生大量不连续的内存碎片，故需要此算法。</li>
<li>标记-整理算法过程是将所有可活动对象向一边移动，然后直接清除掉边界以外的内存。</li>
</ol>
</blockquote>
<p><img src="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/4.png"></p>
<h4 id="全停顿"><a href="#全停顿" class="headerlink" title="全停顿"></a>全停顿</h4><blockquote>
<p> 由于Js是运行在主线程上的，一旦执行垃圾回收算法，就需要将正在执行的Js脚本暂停下来，待垃圾回收完毕后再执行脚本，这种行为叫做<code>全停顿</code></p>
<p>全停顿的影响：在新生代垃圾回收中，空间较小，所以全停顿影响不大。但是在老生代垃圾回收中，如果在执行垃圾回收过程中占用主线程过久，这个时间主线程是不能做其他事情的。</p>
</blockquote>
<blockquote>
<p>增量标记(Incremental Marking)算法解决卡顿：V8将标记过程分为一个个子标记过程和Js脚本<code>交替进行</code>，直到标记完成，这个算法叫做增量标记算法。</p>
</blockquote>
<p><img src="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/5.png"></p>
<h2 id="编译器和解释器：V8如何执行一段Js代码"><a href="#编译器和解释器：V8如何执行一段Js代码" class="headerlink" title="编译器和解释器：V8如何执行一段Js代码"></a>编译器和解释器：V8如何执行一段Js代码</h2><blockquote>
<p>编译器和解释器存在的原因：机器不能直接理解我们所写的代码，所以在执行程序之前需要将我们所写的代码“翻译”成机器能读懂的机器语言，按语言的执行流程，可以把语言划分为<code>编译型语言</code>和<code>解释型语言</code></p>
<p>编译型语言：编译型语言在程序执行之前需要经过编译器的编译过程，并且编译之后会直接保留机器能读懂的二进制文件，这样每次运行时就可以直接运行该二进制文件了，如C/C++/GO</p>
<p>解释型语言：解释型语言编写的程序在每次运行都要通过解释器对程序进行动态解释和执行，比如Python/Go </p>
</blockquote>
<p><img src="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/6.png"></p>
<h3 id="V8是如何执行一段Js代码的"><a href="#V8是如何执行一段Js代码的" class="headerlink" title="V8是如何执行一段Js代码的"></a>V8是如何执行一段Js代码的</h3><p><img src="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/6.png"></p>
<h4 id="生成抽象语法树-AST-和执行上下文"><a href="#生成抽象语法树-AST-和执行上下文" class="headerlink" title="生成抽象语法树(AST)和执行上下文"></a>生成抽象语法树(AST)和执行上下文</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myName = <span class="string">&quot; 极客时间 &quot;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">23</span>;</span><br><span class="line">&#125;</span><br><span class="line">myName = <span class="string">&quot;geektime&quot;</span></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>AST 是非常重要的一种数据结构，在很多项目中有着广泛的应用。其中最著名的一个项目是 Babel。Babel 是一个被广泛使用的代码转码器，可以将 ES6 代码转为 ES5 代码，这意味着你可以现在就用 ES6 编写程序，而不用担心现有环境是否支持 ES6。Babel 的工作原理就是先将 ES6 源码转换为 AST，然后再将 ES6 语法的 AST 转换为 ES5 语法的 AST，最后利用 ES5 的 AST 生成 JavaScript 源代码。Eslint也是。</p>
<p>这段代码经过转义后生成的AST结构如下</p>
</blockquote>
<p><img src="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/7.png"></p>
<h5 id="生成AST"><a href="#生成AST" class="headerlink" title="生成AST"></a>生成AST</h5><ol>
<li>分词(tokenize)，又称词法分析：其作用是将一行行源代码拆成一个个token(语法上不能拆分的最小单位)</li>
</ol>
<p><img src="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/8.png"></p>
<ol start="2">
<li>解析(parse)，又称为语法分析，其作用是将上一步生成的token数据根据语法规则转化为AST，如果源码不符合语法规则则会抛出“语法错误”</li>
</ol>
<h5 id="生成字节码"><a href="#生成字节码" class="headerlink" title="生成字节码"></a>生成字节码</h5><blockquote>
<p>解释器的功能：有了AST和执行上下文后，接下来就用解释器(Ignition)，它会根据AST生成字节码，并解释执行字节码</p>
<p> 出现原因：原来是直接将AST转换为机器码的，刚开始效果很好，但是随着小内存手机上运行Chrome需求的出现，内存占用的问题就出来了。</p>
<p>为什么字节码能解决内存占用问题：字节码就是介于AST和机器码之间的代码，但是与特定类型的机器码无关，字节码需要解释器转化为机器码后才能使用。由下图可知使用字节码可以减少系统的内存使用。</p>
</blockquote>
<p><img src="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/9.png"></p>
<h5 id="执行代码"><a href="#执行代码" class="headerlink" title="执行代码"></a>执行代码</h5><blockquote>
<p>获得字节码后进入执行阶段，如果有一段第一次执行的字节码，解释器会逐条解释执行，在执行字节码的过程中，如果一段代码被<code>执行多次</code>，这种代码就称为<code>热点代码</code>，后台的编译器TurboFan就会把该段热点的字节码编译为高效的机器码， 然后再次执行这段代码时，只要执行编译后的机器码就行，这就大大提升了代码的执行效率。</p>
</blockquote>
<p><img src="/2021/06/02/V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/10.png"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-design/" rel="tag">web-design</a></li></ul>

    </footer>
  </div>

   
   
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020-2021
        <i class="ri-heart-fill heart_icon"></i> CDX
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        由 <a href="https://hexo.io" target="_blank">Hexo</a> 强力驱动
        <span class="division">|</span>
        主题 - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/Logo.svg" alt="CDX"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->


    
  </div>
</body>

</html>